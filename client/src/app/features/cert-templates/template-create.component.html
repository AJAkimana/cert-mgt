<section class="mx-auto flex max-w-5xl flex-col gap-8">
  <header class="flex flex-wrap items-center justify-between gap-4">
    <div>
      <p class="text-xs uppercase tracking-[0.2em] text-slate-500">Template Studio</p>
      <h1 class="text-3xl font-semibold text-slate-900">Create a certificate template</h1>
      <p class="mt-2 max-w-2xl text-sm text-slate-600">
        Define the raw HTML and placeholders used to generate certificates. Keep placeholders
        consistent so APIs can inject values reliably.
      </p>
    </div>
  </header>

  <div class="grid gap-6 lg:grid-cols-[minmax(0,1fr)_320px]">
    <div class="space-y-6">
      <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <h2 class="text-lg font-semibold text-slate-900">Template details</h2>
        <p class="mt-1 text-sm text-slate-500">Set the template name and base structure.</p>

        <form class="mt-5 grid gap-4" [formGroup]="form">
          <div>
            <label class="text-sm font-medium text-slate-700">Template name</label>
            <input
              class="mt-2 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-slate-400 focus:outline-none"
              formControlName="name"
              placeholder="Employee Completion Certificate"
            />
            @if (form.get('name')?.touched && form.get('name')?.invalid) {
              <p class="mt-1 text-xs text-red-600">Name is required.</p>
            }
          </div>

          <div>
            <label class="text-sm font-medium text-slate-700">Description</label>
            <input
              class="mt-2 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-slate-400 focus:outline-none"
              formControlName="description"
              placeholder="Explain how this template should be used"
            />
          </div>

          <div>
            <label class="text-sm font-medium text-slate-700">Raw template (HTML)</label>
            <div class="mt-2">
              @if (isBrowser) {
                <quill-editor
                  formControlName="rawTemplate"
                  class="rounded-xl border border-slate-200"
                  [styles]="{ height: '220px' }"
                  [modules]="{
                    toolbar: [
                      ['bold', 'italic', 'underline'],
                      [{ header: [1, 2, 3, false] }],
                      ['link'],
                    ],
                  }"
                ></quill-editor>
              } @else {
                <textarea
                  class="mt-2 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm"
                  formControlName="rawTemplate"
                  rows="6"
                ></textarea>
              }
            </div>
            @if (form.get('rawTemplate')?.touched && form.get('rawTemplate')?.invalid) {
              <p class="mt-1 text-xs text-red-600">Raw template is required.</p>
            }
          </div>

          <div>
            <label class="text-sm font-medium text-slate-700">Placeholders</label>
            <div class="mt-3 space-y-3" formArrayName="placeholders">
              @for (placeholder of placeholdersArray.controls; track $index) {
                <div
                  class="grid gap-3 rounded-xl border border-slate-200 bg-slate-50 p-3 md:grid-cols-[1.2fr_0.8fr_1fr_auto]"
                  [formGroupName]="$index"
                >
                  <div>
                    <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500"
                      >Key</label
                    >
                    <input
                      class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:border-slate-400 focus:outline-none"
                      formControlName="key"
                      placeholder="fullName"
                    />
                  </div>
                  <div>
                    <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500"
                      >Type</label
                    >
                    <select
                      class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-2 py-2 text-xs focus:border-slate-400 focus:outline-none"
                      formControlName="type"
                    >
                      @for (type of placeholderTypes; track type) {
                        <option [value]="type">{{ type }}</option>
                      }
                    </select>
                  </div>
                  <div>
                    <label class="text-[11px] font-semibold uppercase tracking-wide text-slate-500"
                      >Format</label
                    >
                    <input
                      class="mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:border-slate-400 focus:outline-none"
                      formControlName="format"
                      placeholder="yyyy-MM-dd"
                    />
                  </div>
                  <div class="flex flex-col gap-2">
                    <button
                      type="button"
                      class="rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 hover:border-slate-300"
                      (click)="insertToken($index)"
                    >
                      Insert token
                    </button>
                    <button
                      type="button"
                      class="rounded-lg border border-rose-200 bg-rose-50 px-3 py-2 text-xs font-semibold text-rose-600 hover:border-rose-300"
                      (click)="removePlaceholder($index)"
                    >
                      Remove
                    </button>
                  </div>
                </div>
              }
            </div>
            <button
              type="button"
              class="mt-3 w-fit rounded-xl border border-slate-200 px-4 py-2 text-xs font-semibold text-slate-700 hover:border-slate-300"
              (click)="addPlaceholder()"
            >
              Add placeholder
            </button>
            <p class="mt-2 text-xs text-slate-500">
              Click “Insert token” to add
              <span class="font-semibold">{{ '{fullName}' }}</span> into the editor, so it lines up
              with the placeholder definition.
            </p>
          </div>

          <label class="flex items-center gap-3 text-sm text-slate-700">
            <input type="checkbox" class="h-4 w-4 accent-slate-900" formControlName="isActive" />
            Mark as active
          </label>
        </form>
      </div>
    </div>

    <aside class="space-y-6">
      <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <h3 class="text-sm font-semibold text-slate-700">Placeholder rules</h3>
        <p class="mt-2 text-xs text-slate-500">
          Each placeholder you define must appear in the HTML as a token like
          <span class="font-semibold">{{ '{fullName}' }}</span
          >. Use the Insert button to avoid mismatches.
        </p>
        <ul class="mt-4 space-y-2 text-xs text-slate-600">
          <li>Keep keys short and lowercase.</li>
          <li>Use format only for date or number types.</li>
          <li>Tokens must exist in the template before saving.</li>
        </ul>
      </div>

      <div class="rounded-2xl border border-slate-200 bg-slate-950 p-6 text-white shadow-sm">
        <h3 class="text-sm font-semibold">Ready to publish?</h3>
        <p class="mt-2 text-xs text-slate-300">
          Save the template and start generating certificates right away.
        </p>
        <button
          type="button"
          class="mt-4 w-full rounded-xl bg-white px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100 disabled:opacity-60"
          (click)="submit()"
          [disabled]="isSaving()"
        >
          @if (isSaving()) {
            Saving...
          } @else {
            Create template
          }
        </button>
      </div>
    </aside>
  </div>
</section>
